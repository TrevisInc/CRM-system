var app=angular.module("application",["ngRoute","ngAnimate","ngSanitize","ui.bootstrap","xeditable","cgNotify"]);app.config(["$routeProvider","$locationProvider",function(t,e){e.hashPrefix(""),t.when("/",{templateUrl:"app/views/home.template.html",controller:"HomeController"}).when("/reg",{templateUrl:"app/views/registration.template.html",controller:"RegistrationController"}).when("/student/:studentId",{templateUrl:"app/views/student.home.template.html",controller:"StudentHomeController"}).when("/student/:studentId/editProfile",{templateUrl:"app/views/user.edit.profile.template.html",controller:"UserEditProfileController"}).when("/student/:studentId/group/:groupId",{templateUrl:"app/views/student.group.template.html",controller:"StudentGroupController"}).when("/student/:studentId/homework",{templateUrl:"app/views/student.homework.template.html",controller:"StudentHomeworkController"}).when("/student/:studentId/schedule/:groupId",{templateUrl:"app/views/student.schedule.template.html",controller:"StudentScheduleController"}).when("/teacher/:teacherId",{templateUrl:"app/views/teacher.home.template.html",controller:"TeacherHomeController"}).when("/teacher/:teacherId/editProfile",{templateUrl:"app/views/user.edit.profile.template.html",controller:"UserEditProfileController"}).when("/teacher/:teacherId/schedule",{templateUrl:"app/views/teacher.schedule.template.html",controller:"TeacherScheduleController"}).when("/teacher/:groupId/journal",{templateUrl:"app/views/teacher.journal.template.html",controller:"TeacherJournalController"}).otherwise("/")}]),app.config(["$httpProvider",function(t){t.defaults.headers.common.Authorization="Bearer "+localStorage.getItem("authToken")}]),app.run(["editableOptions",function(t){t.theme="bs3"}]),function(){"use strict";app.service("utils",["notify",function(t){this.notify=function(e){t.closeAll();var n={message:"",type:"alert",duration:1e3};e=angular.extend(n,e),t({message:e.message,classes:"alert-"+e.type})}}])}(),app.constant("webApi",{DOMAIN:"http://node1.fe.a-level.com.ua"}),function(){"use strict";app.factory("DataRepository",["$http","webApi",function(t,e){function n(){return t.get(e.DOMAIN+"/api/v1/groups")}function o(n){return t.post(e.DOMAIN+"/api/v1/students",n)}function r(n){return t.post(e.DOMAIN+"/api/v1/account/login",n)}function a(n){return t.get(e.DOMAIN+"/api/v1/news?count=3&page="+n+"&orderBy=date_added&dir=")}function u(n){return t.get(e.DOMAIN+"/api/v1/students/"+n+"/groups")}function s(n){return t.get(e.DOMAIN+"/api/v1/groups/"+n+"/students")}function l(n){return t.get(e.DOMAIN+"/api/v1/groups/"+n)}function c(n){return t.get(e.DOMAIN+"/api/v1/groups/"+n+"/teachers")}function i(n){return t.get(e.DOMAIN+"/api/v1/teachers/"+n+"/groups")}function p(n){return t.get(e.DOMAIN+"/api/v1/students/"+n)}function d(n){return t.get(e.DOMAIN+"/api/v1/teachers/"+n)}function g(n){return t.get(e.DOMAIN+"/api/v1/groups/"+n+"/schedule")}function f(n,o,r){return t.get(e.DOMAIN+"/api/v1/groups/"+n+"/schedule?page="+o+"&count="+r+"&dir=asc")}function h(n,o){return t.put(e.DOMAIN+"/api/v1/groups/"+n+"/schedule",o)}function m(n){return t.get(e.DOMAIN+"/api/v1/groups/"+n+"/journal")}function w(n,o){return t.get(e.DOMAIN+"/api/v1/groups/"+n+"/journal/"+o)}function S(n){return t.put(e.DOMAIN+"/api/v1/journal",n)}return{getGroupList:n,setStudent:o,getUser:r,getNews:a,getGroupsByStudent:u,getStudentsByGroup:s,getGroup:l,getTeachersByGroup:c,getGroupsByTeacher:i,getStudentData:p,getTeacherData:d,getScheduleData:g,getScheduleDataPage:f,putScheduleData:h,getJournalGroup:m,getJournalById:w,putStatusInJournal:S}}])}(),function(){"use strict";app.controller("HomeController",["$scope",function(t){}])}(),function(){"use strict";app.controller("NewsController",["$scope","DataRepository",function(t,e){t.currentPage=1,t.totalItems=500,t.maxSize=3,e.getNews(t.currentPage).then(function(e){t.someNews=e.data.items},function(t){console.log(t)}),t.pageChanged=function(){e.getNews(t.currentPage).then(function(e){t.someNews=e.data.items},function(t){console.log(t)})}}])}(),function(){"use strict";app.controller("HeaderController",["$scope","$location","DataRepository","$http","utils",function(t,e,n,o,r){t.newLogin={login:"",password:""},t.logVal=!0,t.enterOnSite=function(){n.getUser(t.newLogin).then(function(n){var r=n.data;o.defaults.headers.common.Authorization="Bearer "+n.data.authToken,1===r.role_id?e.path("/student/"+r.id):2===r.role_id?e.path("/teacher/"+r.id):e.path("/"),localStorage.setItem("role_id",r.role_id),localStorage.setItem("id",r.id),localStorage.setItem("authToken",r.authToken),t.logVal=!0},function(e){e.status===-1?r.notify({message:"Сервер с данными сейчас недоступен, попробуйте позже",type:"danger"}):401===e.status&&(0===e.config.data.login.length&&0===e.config.data.password.length?r.notify({message:"Для входа в систему, авторизируйтесь пожалуйста",type:"danger"}):r.notify({message:"Проверьте, пожалуйста, верность введенных данных и попробуйте войти снова",type:"danger"})),console.log(e),t.logVal=!1})}}])}(),function(){"use strict";app.controller("RegistrationController",["$scope","DataRepository",function(t,e){var n={firstname:"",lastname:"",email:"",login:"",password:"",group_id:null};t.newUser=angular.extend({},n),e.getGroupList().then(function(e){t.someGroup=e.data},function(t){console.log(t)}),t.dispatchForm=function(){console.log(t.newUser),e.setStudent(t.newUser).then(function(t){},function(t){console.log(t.data)})}}])}(),function(){"use strict";app.controller("StudentHomeController",["$scope",function(t){}])}(),function(){"use strict";app.controller("StudentHeaderController",["$scope","DataRepository","$location",function(t,e,n){t.role=localStorage.getItem("role_id"),t.userId=localStorage.getItem("id"),1==t.role?e.getStudentData(t.userId).then(function(e){t.userName=e.data.firstname},function(t){console.log(t)}):2==t.role&&e.getTeacherData(t.userId).then(function(e){t.userName=e.data.firstname},function(t){console.log(t)}),t.logOut=function(){localStorage.clear(),n.path("/")}}])}(),function(){"use strict";app.controller("StudentMenuController",["$scope","DataRepository",function(t,e){t.student=localStorage.getItem("id"),e.getGroupsByStudent(t.student).then(function(e){t.groupsByStudent=e.data},function(t){}),t.setGroupId=function(t){sessionStorage.setItem("groupId",t)}}])}(),function(){"use strict";app.controller("StudentGroupController",["$scope","DataRepository","utils",function(t,e,n){var o=sessionStorage.getItem("groupId");e.getGroup(o).then(function(r){t.groupByStudent=r.data,e.getStudentsByGroup(o).then(function(e){t.studentsByGroup=e.data},function(t){404===t.status&&n.notify({message:"Сервер с данными сейчас недоступен, попробуйте позже",type:"danger"})})},function(t){})}])}(),function(){"use strict";app.controller("StudentHomeworkController",["$scope","DataRepository",function(t,e){t.data={"static":!0},t.homeworksDone=[],t.homeworksToDo=[],t.sendHomework=function(){console.log("отправил ссылку")}}])}(),function(){"use strict";app.controller("UserEditProfileController",["$scope","DataRepository",function(t,e){t.role=localStorage.getItem("role_id"),t.userId=localStorage.getItem("id"),1==t.role?e.getStudentData(t.userId).then(function(e){t.user=e.data},function(t){console.log(t)}):2==t.role&&e.getTeacherData(t.userId).then(function(e){t.user=e.data},function(t){console.log(t)})}])}(),function(){"use strict";app.controller("TeacherHomeController",["$scope",function(t){}])}(),function(){"use strict";app.controller("TeacherMenuController",["$scope","DataRepository",function(t,e){t.user=localStorage.getItem("id"),e.getGroupsByTeacher(t.user).then(function(e){t.groupsByTeacher=e.data},function(t){console.log(t)}),t.setGroupId=function(t){sessionStorage.setItem("groupId",t)}}])}(),function(){"use strict";app.controller("TeacherScheduleController",["$scope","DataRepository","$uibModal",function(t,e,n){t.currentPage=0,t.totalItems=500,t.maxSize=4,e.getScheduleData(1).then(function(n){for(var o=n.data,r=0;r<o.length;r++){var a=new Date,u=new Date(o[r].date);if(u>a){t.currentPage=Math.ceil(r/9);break}}e.getScheduleDataPage(1,t.currentPage).then(function(e){t.schedule=e.data},function(t){})},function(t){}),t.pageChanged=function(){e.getScheduleDataPage(1,t.currentPage).then(function(e){t.schedule=e.data},function(t){})},t.controlDate=function(t){var e=new Date,n=new Date(t);return n>e},t.editLesson=function(t){sessionStorage.setItem("id_lesson",t);var o=n.open({templateUrl:"app/modal/editLesson/template.html",controller:"EditLessonController",size:"md"});o.result.then(function(n){e.putScheduleData(t,n).then(function(t){console.log("ok")},function(t){console.log("error",t)})},function(t){})}}])}(),function(){"use strict";app.controller("StudentScheduleController",["$scope","DataRepository","utils",function(t,e,n){var o=sessionStorage.getItem("groupId");e.getGroup(o).then(function(e){t.group=e.data},function(t){}),t.currentPage=1;var r=9;e.getScheduleData(o).then(function(a){var u=a.data;t.totalItems=Object.keys(u).length+r,t.maxSize=Math.ceil(t.totalItems/r);for(var s=1;s<u.length;s++){var l=new Date,c=new Date(u[s].date);if(c>l){t.currentPage=Math.ceil(s/r);break}}e.getScheduleDataPage(o,t.currentPage,r).then(function(e){t.schedule=e.data},function(t){n.notify({message:"Сервер с данными сейчас недоступен, попробуйте позже",type:"danger"})})},function(t){n.notify({message:"Сервер с данными сейчас недоступен, попробуйте позже",type:"danger"})}),t.pageChanged=function(){e.getScheduleDataPage(o,t.currentPage,r).then(function(e){t.schedule=e.data},function(t){n.notify({message:"Сервер с данными сейчас недоступен, попробуйте позже",type:"danger"})})},t.controlDate=function(t){var e=new Date,n=new Date(t);return n>e?(console.log("true"),!0):(console.log("false"),!1)}}])}(),function(){function t(t,e,n){var o=sessionStorage.getItem("id_lesson");n.getScheduleData(1).then(function(e){e.data.forEach(function(e){e.id==o&&(t.lesson=e)})},function(t){console.log("Ошибка getScheduleData")}),t.cancel=function(){e.dismiss("cancel")},t.ok=function(){sessionStorage.clear(),e.close(t.lesson)}}app.controller("EditLessonController",t),t.$inject=["$scope","$uibModalInstance","DataRepository"]}(),function(){"use strict";app.controller("TeacherJournalController",["$scope","DataRepository","$filter",function(t,e,n){var o=sessionStorage.getItem("groupId");e.getGroup(o).then(function(e){t.groupName=e.data.title},function(t){console.log(t)});var r={student_id:null,date_id:null,status:0};t.newStatus=angular.extend({},r),t.studentPresentCounter=null,t.showResult=!1,t.showError=!1,t.dt=null,t.format="dd-MMMM-yyyy",t.popup={opened:!1},t.open=function(){t.popup.opened=!0,t.showError=!1},t.showtable=function(){t.studentPresentCounter=null,t.showError=!1,e.getJournalGroup(o).then(function(r){var a=new Date,u=new Date(t.dt),s=r.data.filter(function(e){if(n("date")(e.date,"dd-MM-yyyy")===n("date")(t.dt,"dd-MM-yyyy"))return e})[0];void 0===s?(t.showError=!0,t.showResult=!1):(t.ArrForPrint=s.students,t.showResult=!0,t.newStatus.date_id=s.id,e.getJournalById(o,s.id).then(function(e){t.studentCounter=e.data[0].students.length,a>u&&e.data[0].students.forEach(function(e){1===e.status&&t.studentPresentCounter++})},function(t){console.log(t)}))},function(t){console.log(t)})},t.statusSuccess=function(n){t.newStatus.student_id=n.id,0===n.status?t.newStatus.status=1:t.newStatus.status=0,n.status=+!n.status,e.putStatusInJournal(t.newStatus).then(function(e){1===n.status?t.studentPresentCounter++:t.studentPresentCounter--},function(t){console.log(t)})}}])}();